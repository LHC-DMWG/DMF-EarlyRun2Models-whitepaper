
tex_source := $(wildcard *.tex) contributors.tex $(wildcard tex/*.tex)
graphics_mp := $(subst feynmp.mp,,$(wildcard *.mp))
graphics_mp1 := $(patsubst %.mp,%.1,$(graphics_mp))

doc.pdf: pass1 $(graphics_mp1) $(graphics_mp)
	pdflatex doc.tex
	pdflatex doc.tex

pass1: clean $(tex_source) figures/*.pdf figures/svg/*.svg
	pdflatex doc.tex
	bibtex doc

mp: doc.pdf cleanMP 
	pdflatex doc.tex
	pdflatex doc.tex

view: doc.pdf
	if [ `uname` = "Darwin" ]; then open doc.pdf; elif [ `uname` = "Linux" ]; then if command -v okular; then okular doc.pdf; elif command -v acroread; then acroread doc.pdf; fi; fi

contributors.tex: members-lhc-dmf-contributors.csv contributors.pl
	echo "% this file auto-generated by contributors.pl" > contributors.tex
	perl contributors.pl >> contributors.tex

cleanMP: $(wildcard *.mp)
	rm -f `ls -1 *.mp | sed 's/\.mp$\/\*/'`

clean: cleanMP
	rm -f doc.aux doc.blg doc.log doc.out doc.bbl doc.toc
	rm -f *~ tex/*~
	rm -f doc.pdf 

