

There are several matrix element implementations of the
DM production through spin-0 and spin-1 mediators.

For a spin-1 mediator, the implementation in \powheg generates
DM pair production with 1 parton at next-to-leading order (NLO), whilst \madgraph and \mcfm are at leading order (LO). As shown in \powheg Ref.\,\cite{Haisch:2013ata}, including NLO corrections result in an enhancement in the cross section as compared to LO and though this is not significant, it does lead to a substantial reduction in the dependence on the choice of the renormalization and factorization scale and hence the theoretical uncertainty on the signal prediction. 
Since NLO calculations are available for the process in \powheg, we recommend to proceed with \powheg as the generator of choice. 

For a spin-0 mediator, the top-quark loop is the most important
consideration.
The matrix element implementation of the \schannel spin-0 mediated DM production is available in \mcfm~\cite{Fox:2012ru,Harris:2014hga} and \powheg~\cite{Haisch:2015ioa} with the full top-loop calculation at LO.
The \powheg and \mcfm implementations include the finite
top quark mass dependence for DM pair production with 1 parton at LO.
For consistency with the spin-1 generation, we recommend using \powheg
for this case as well.

Here, we document some specific settings needed to run the \powheg 
generation for the Dark Matter models. \powheg can handle the generation of events (be it at LO or NLO) 
in the 2 different modes explained in the following. The second one 
is the recommended one. The relevant keywords in the input card are 
\bornsuppfact and \bornktmin. 

\begin{itemize} 

\item \powheg can handle the generation of events (be it at LO or NLO) 
in the 2 different modes explained in the following. The second one 
is the recommended one. The relevant keywords in the input card are 
bornsuppfact and bornktmin. 

% \begin{itemize}
\item The \powheg implementation allows to generate a single sample that provides sufficient statistics in all signal regions. %by optimizing the following two parameters:
%\begin{itemize}
\powheg generates weighted events and the \bornsuppfact parameter is used to set the event suppression factor according to
\begin{equation}
F(\kT)=\frac{\kT^2}{\kT^2+\bornsuppfact^2} \;.
\end{equation}
In this way, the events at, for instance low \MET, are suppressed and receive higher event weights which ensures higher statistics at high \MET. We recommend to set \bornsuppfact to 1000 (\gev).
\item The \bornktmin parameter allows to suppress the low \MET region even further by starting the generation at a certain value of \kT. It is recommended to set this parameter  to half the lower analysis \MET cut, for the event selection used in the CMS/ATLAS monojet analyses for instance the proposed value for \bornktmin is 150. However, this parameter should be set keeping in mind the event selection of all the analyses that will use these signal samples and hence a threshold lower than 150 may be required. 
%\end{itemize}

\item Set \runningwidth to 0.
\item Set \masslow and \masshigh to -1.
\item The minimal values for \ncallOne, \itmxOne, \ncallTwo, \itmxTwo are 250000, 5, 1000000, 5 for the \modelDMV model, respectively. In order to increase speed, set \foldsci and \foldy to 2 and keep \foldphi at 1. 
\item The minimal values for \ncallOne, \itmxOne, \ncallTwo, \itmxTwo are 100000, 5, 100000, 5 for the \modelDMStloop model, respectively.
\item Allow negative weights for the \modelDMV model by setting \withnegweights to 1.
\item Since the \modelDMStloop model is a leading order process, set \LOevents and \bornonly are set to 1 internally.
\item Automatic calculation of systematic uncertainties associated with the choice of hard scale and PDFs.
\end{itemize}
{\bf [Comment on proper PDF sets to use, concerns about sea quark PDF in b-initiated diagrams (perhaps the latter belongs in the b-flavored DM section]}


\section{CKKW parton matching implementation}
\label{sec:monojet_parton_match}

The parton matching techniques are implemented in the mono-jet like MC generation in order to avoid double counting the partons from matrix elements and parton showering. The CKKW matching is better developed and preferred~\cite{Alwall:1405.0301}~\cite{Alwall:0706.2569}. As the illustration sample, the EFT D5 samples are generated with \madgraphFiveaMCNLO version 2.2.2. The technical implementations are shown as below.

On the generator side, i.e., \madgraphFiveaMCNLO:
\begin{itemize}
\item \texttt{ickkw = 0}
\item \texttt{ktdurham = }matching scale
\item \texttt{dparameter = 0.4}
\item \texttt{dokt = T}
\item \texttt{ptj=20}
\item \texttt{drjj=0}
\item \texttt{mmjj=0}
\item \texttt{ptj1min=0}
\end{itemize}
On the parton showering side, i.e., \pythiaEight:
\begin{itemize}
\item \texttt{Merging:ktType           = 1}
\item \texttt{Merging:TMS              = }matching scale
\item \texttt{1000022:all = chi chi~ 2 0 0 30.0 0.0 0.0 0.0 0.0}
\item \texttt{1000022:isVisible = false}
\item \texttt{Merging:doKTMerging      = on}
\item \texttt{Merging:Process          = pp>{chi,1000022}{chi~,-1000022}}
\item \texttt{Merging:nJetMax          = 2}
\end{itemize}
The matching scales should be the same for the generation and parton showering. In \madgraph5aMCNLO, the particle data group ID \texttt{1000022} is used for weakly interacting dark matter candidates, which should be informed to \pythiaEight.

In this test we are generating the process with up to two parton emissions, so the command \texttt{Merging:nJetMax = 2} is applied to \pythiaEight. The different parton emission cases are generated separately:
\begin{itemize}
\item \texttt{p p > chi chi~}
\item \texttt{p p > chi chi~ j}
\item \texttt{p p > chi chi~ j j}
\end{itemize}
Two matching scales are tested at 30 and 80 \gev. The differential jet rates are shown in Fig. \ref{fig:CKKW_D5_30} for matching scale 30 \gev and Fig. \ref{fig:CKKW_D5_80} for 80 \gev. The 80 \gev matching scale gives smoother distribution, which is desired to avoid artificial effect due to parton matching. There will be a small kink around the matching scale for both cases.

\begin{figure}[h!]
	\centering  
	\subfloat[$1\rightarrow2$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet1to2_30.pdf}
	}
	\hfill
	\subfloat[$2\rightarrow3$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet2to3_30.pdf}
	}
	\hfill
	\subfloat[$3\rightarrow4$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet3to4_30.pdf}
	}
	\hfill
	\subfloat[$4\rightarrow5$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet4to5_30.pdf}
	}
	\caption{Jet differential rates distributions for EFT D5 sample with CKKW matching scale at 30 \gev. 0-, 1- and 2-parton emission cases are generated separately. A vertical line is drawn at the matching scale.}
	\label{fig:CKKW_D5_30}
\end{figure}


\begin{figure}[h!]
	\centering  
	\subfloat[$1\rightarrow2$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet1to2_80.pdf}
	}
	\hfill
	\subfloat[$2\rightarrow3$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet2to3_80.pdf}
	}
	\hfill
	\subfloat[$3\rightarrow4$ parton process]{%
    \includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet3to4_80.pdf}
	}
	\hfill
	\subfloat[$4\rightarrow5$ parton process]{%
    \includegraphics[width=0.48\linewidth]{figures/monojet_appendix/HistoJet4to5_80.pdf}
	}
  \caption{Jet differential rates distributions for EFT D5 sample with CKKW matching scale at 80 \gev. 0-, 1- and 2-parton emission cases are generated separately. A vertical line is drawn at the matching scale.}
  \label{fig:CKKW_D5_80}
\end{figure}

To compare the effect in a finer step, the matching scales at 30, 50, 70, 80 and 90 \gev are plotted in Fig\ref{fig:CKKW_D5_zoom}. Globally good agreement is seen among different matching scales, with some difference observed around the matching scale. A closer look in this range shows that the 80 and 90 \gev matching scales produce very close distributions, so it is safe to use 80 \gev as the baseline matching scale.

\begin{figure}[h!]
	\centering  
	\subfloat[$1\rightarrow2$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/compare_plot_1.pdf}
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/window_plot_1.pdf}
	}
	\hfill
	\subfloat[$2\rightarrow3$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/compare_plot_2.pdf}
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/window_plot_2.pdf}
	}
	\hfill
	\subfloat[$3\rightarrow4$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/compare_plot_3.pdf}
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/window_plot_3.pdf}
	}
	\hfill
	\subfloat[$4\rightarrow5$ parton process]{%
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/compare_plot_4.pdf}
		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/window_plot_4.pdf}
	}
  \caption{Jet differential rates distributions for EFT D5 sample with CKKW matching scale at 30, 50, 70, 80 and 90 \gev. 0-, 1- and 2-parton emission cases are generated separately and the total merged contribution is shown. A closer look is shown around the matching scale.}
  \label{fig:CKKW_D5_zoom}
\end{figure}

The MC distributions for the missing transverse energy and transverse momenta for the leading and subleading jets are plotted in Fig.. For the mono-jet analysis, usually a missing transverse energy cut larger than 300 \gev is applied for offline selection, which makes the contribution of the 0-parton emission case negligible in the mono-jet analysis.

\begin{figure}[h!]
	\centering  
%	\subfloat[Missing transverse momentum]{%
    \includegraphics[width=0.8\linewidth]{figures/monojet_appendix/MET_matching80.pdf}
%	}
%	\hfill
%	\subfloat[Transverse momentum of leading jet]{%
%    \includegraphics[width=0.48\linewidth]{figures/monojet_appendix/jet1pt_matching80.pdf}
%	}
%	\hfill
%	\subfloat[Transverse momentum of subleading jet]{%
%    \includegraphics[width=0.48\linewidth]{figures/monojet_appendix/jet2pt_matching80.pdf}
%	}
%	\caption{Kinematics distributions for EFT D5 sample with CKKW matching scale at 80 \gev. 0-, 1- and 2-parton emission cases are generated separately and added together by cross sections. The 0-parton emission case has very limited contribution for missing transverse energy larger than 300 \gev region.}
	\caption{Missing transverse momentum distributions for EFT D5 sample with CKKW matching scale at 80 \gev. 0-, 1- and 2-parton emission cases are generated separately and added together by cross sections. The 0-parton emission case has very limited contribution for missing transverse energy larger than 300 \gev region.}
	\label{fig:Kine_D5_80}
\end{figure}


\section{Parton emission generation}
\label{sec:monojet_parton_emission}
In order to describe the signal kinematics correctly and save time in MC generation, the parton emissions will only be generated up to a certain numbers of parton and ignore the cases with more partons. The later ones usually have cross sections small enough and limited contribution in the interested kinematic regions.

It is found that the 3- or more-parton emission cases are negligible in our intersted regions, but the 2-parton emission case has significant contributions. The 0- and 1-parton emissions are out of discussion since they give the baseline signature in this analysis. The impacts of 2- and 3-parton emissions are quantified in this section.

Here the 0-, 1-, 2- and 3-parton emissions are generated separately and requested in matching step with \texttt{Merging:nJetMax=3} and scale at 80 \gev in Pythia8 for 0+1+2+3 parton emission case, while \texttt{Merging:nJetMax=2} requested for 0+1+2 case and \texttt{Merging:nJetMax=1} requested for 0+1 case. The MET distribution is plotted in Fig.\ref{fig:RatioKine_D5}, while the jet multiplicity with $p_{T}>$30GeV and $|\eta|<$2.8 requirement is shown in Fig.\ref{fig:RatioKine_D5_2}.

\begin{figure}[h!]
	\centering  
%	\subfloat[Missing transverse momentum]{%
	\includegraphics[width=0.8\linewidth]{figures/monojet_appendix/h_MET_MET250.pdf}
%	}
%	\hfill
%	\subfloat[Transverse momentum of leading jet]{%
%		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/h_pt1_MET250.pdf}
%	}
%	\hfill
%	\subfloat[Transverse momentum of subleading jet]{%
%		\includegraphics[width=0.48\linewidth]{figures/monojet_appendix/h_pt2_MET250.pdf}
%	}
%	\caption{Kinematics distributions for EFT D5 sample with CKKW matching scale at 80 \gev. 0-, 1-, 2- and 3-parton emission cases are generated separatedly and added together by cross sections.}
	\caption{Missing transverse momentum distributions for EFT D5 sample with CKKW matching scale at 80 \gev. 0-, 1-, 2- and 3-parton emission cases are generated separatedly and added together by cross sections.}
	\label{fig:RatioKine_D5}
\end{figure}


\begin{figure}[h!]
	\centering  
%	\subfloat[Jet multiplicity, leading jet $p_{T}>30$ \gev]{%
%    \includegraphics[width=0.48\linewidth]{figures/monojet_appendix/h_njet30.pdf}
%	}
%	\hfill
%	\subfloat[Jet multiplicity, leading jet $p_{T}>80$ \gev]{%
%    \includegraphics[width=0.48\linewidth]{figures/monojet_appendix/h_njet80.pdf}
%	}
%	\hfill
%	\subfloat[Jet multiplicity, leading jet $p_{T}>250$ \gev]{%
	\includegraphics[width=0.8\linewidth]{figures/monojet_appendix/h_njet250.pdf}
%	}
%	\caption{Jet multiplicity distributions for EFT D5 sample with CKKW matching scale at 80 \gev. 0-, 1-, 2- and 3-parton emission cases are generated separatedly and added together by cross sections.}
	\caption{Jet multiplicity distribution for EFT D5 sample with CKKW matching scale at 80 \gev. 0-, 1-, 2- and 3-parton emission cases are generated separatedly and added together by cross sections. The leading jet $p_{T}$ is required to be larger than 250 GeV.}
	\label{fig:RatioKine_D5_2}
\end{figure}

With the ATLAS run-I baseline cut (MET and leading jet $p_{T}$ larger than 250 \gev, less than 4 jets), the 0+1 parton emission has 17.4\% yield less compared to 0+1+2+3 parton emission, while the 0+1+2 has 2.2\% less. With MET$>$400 \gev, 0+1 parton emission has 16.8\% yield less and 0+1+2 parton emission has 2.4\% less compared to 0+1+2+3 parton emission. With MET$>$600 \gev, 0+1 parton emission has 16.5\% yield less and 0+1+2 parton emission has 2.9\% less compared to 0+1+2+3 parton emission. The same numbers hold if a symmetric cut is added on leading jet transverse momentum.


\section{Model implementation for mono-Higgs models}

All three Higgs+MET models are generated at leading
order with MadGraph 2.2.2, using Pythia8 for the parton shower.
The MadGraph implementations of the scalar and vector models can be found on the Forum SVN 
repository~\cite{ForumSVN_EWMonoHiggs}, while the 2HDM model can be found
at this link~\cite{ForumSVN_EWMonoHiggs_2HDM}.

In all cases, it is recommended not to handle the $h$ decay through MadGraph as
it does not include the proper $h$ branching ratios, or, if using MadGraph, then the 
resulting cross section should be rescaled to match onto the correct branching ratio.

\newthought{Madgraph details for scalar mediator Higgs+MET model}

In this model, the contribution from the $gghS$ box is included through an effective 
Lagrangian evaluated in the large $m_t$ limit. 
This may overestimate the rates of the $h + \MET$ signal~\cite{Haisch:2012kf}, but a full evaluation
is left to future studies. 

\newthought{Madgraph details for 2HDM Higgs+MET model}
  
 The two couplings that can be changed in the Madgraph model follow the nomenclature below:
 \begin{itemize}
 	\item \texttt{Tb} - $\tan \beta$
 	\item \texttt{gz} - $g_z$, gauge coupling of \Zprime to quarks
 \end{itemize}
 The other couplings are not changed, including \texttt{gx} (the $A \bar \chiDM \chiDM$ coupling) which has little impact on the signal. 
 $\sin \alpha$ is fixed internally such that $\cos (\beta-\alpha) = 0$. 
 The width of the \Zprime and $A$ can be computed automatically within Madgraph. 
 The couplings here don't affect the signal kinematics, so they can be fixed to default values 
 and then the signal rates can be scaled appropriately. 
 
The nomenclature for the masses in the Madgraph model is:
 \begin{itemize}
 	\item \texttt{MZp} - PDG ID 32 - \Zprime
 	\item \texttt{MA0} - PDG ID 28 - $A$
 	\item \texttt{MX} - PDG ID 1000022 - dark matter particle
 \end{itemize}
 
The other masses are unchanged and do not affect the result. 
 Both $\Zprime \to hZ(\bar \nu \nu)$ and  $\Zprime \to hA(\bar \chiDM \chiDM)$ contribute to the final state, scaling
 different with model parameters. We recommend to generate them separately, 
 and then add the two signal processes together weighted by cross sections.
 % These signals should be generated separately since they have different $\tan \beta, M_A$ dependence.  


\section{Heavy Flavor Models} 
In this particular model we recommend an additional care when choosing
the flavor scheme generation. 
It is found that the best modeling of two $b$-quarks final states is
achieved using a 4-flavor scheme and a massive treatment of the
$b$-quarks \Todo{[TODO: Add reference]}.
% We recommend to use in the generation NNPDF3.0 set (lhaid
%263400).
In addition, we recommend to calculate the cross sections of these
models in the 5-flavor scheme, and as in the $t bar t$ case we provide 
values for the suggested coupling scan in the appendix. 
The PDF used to calculate these cross section is NNPDF3.0 (lhaid 263000). 

\Todo{[TODO: The following figures are placeholders for now and will be added later]}.

\begin{figure}
  \vbox{\hfill}
  \caption{Comparison of the subleading jet $p_T$ and $b$-jet multiplicity
    for $bb$+DM scalar model generated in the 4-flavor (left) and 5-flavor (right)
    schemes, respectively}
\end{figure}

\section{Single Top Models}

Card files for MadGraph are provided on the Forum SVN repository~\cite{ForumSVN_EWMonoTop}, 
corresponding to the Lagrangian from~\cite{AndreaFuksMaltoni}. 
Each coupling constant of this model can be set via the parameter card and 
the blocks which are relevant for the two models used for the experimental searches are described below.
The relevant parameters in the MadGraph parameter cards, also expressed in the notation introduced in the 
previous Section, are as follows for the two models considered.

\begin{enumerate}

\item Resonant scalar model described by the Lagrangian~\eqref{eq:lagrangianResonant}
  \begin{itemize}
  \item \texttt{AQS} and \texttt{BQS}: $3\times 3$ matrices (flavour space) fixing the coupling of the scalar $\phi$ ($S$ stands for scalar) and $down$-type quarks ($Q$ stands for quarks), previously called $a^q/b^q_{SR}$.
  \item \texttt{A12S} and \texttt{B12S}: $3\times 1$ matrices (flavor space) fixing the coupling of the new fermion $\chiDM$ (where $12$ stands for spin-$1/2$ fermion) and $up$-type quarks, previously called $a^{1/2}_{VR}$.
  \end{itemize}  
  
\item Non-resonant vectorial model described by the Lagrangian~\eqref{eq:lagrangianNonResonantVector}
\begin{itemize}
\item \texttt{A1FC} and \texttt{B1FC}: $3\times 3$ matrices (flavor space) fixing the coupling of the vector $V$ ($1$ stands for vector) and $up$-type quarks, previously called $a^1_{FC}$. 
\item particle name: the dark matter candidate $\chiDM$ is not implemented %(as this model assumes $\BR{V}{\chiDM\chiDM}=100\%$)
\end{itemize}

\end{enumerate}

The width of the scalar resonance and of the new vector are set to all allowed decays in the ATLAS implementation,
while the only allowed decay in the CMS implementation to the new fermion and a top quark for the resonant model. 
\Todo{Continue discussion between ATLAS and CMS to reach an agreement, or include instructions to compare results.}

\section{EFT Mono-Higgs implementation}

These models are generated at leading
order with MadGraph 2.2.2, using Pythia8 for the parton shower. No matching is performed. 
Parameter cards can be found on the Forum SVN repository:~\cite{ForumSVN_EWMonoHiggs} for operators with Higgs+MET final states
and ~\cite{ForumSVN_EWEFTD7} for $W/Z/\gamma$ final states.

\section{Simplified Models of Mono-Higgs}

These models are generated at leading
order with MadGraph 2.2.2, using Pythia8 for the parton shower. No matching is performed. 
Parameter cards can be found on the Forum SVN 
repository~\cite{ForumSVN_EWMonoHiggs_2HDM, ForumSVN_EWMonoHiggs}.
